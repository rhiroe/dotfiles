#!/usr/bin/env zsh

while (( $# > 0 ))
do
  case $1 in
    --envfile=*)
      ENVFILE=$(echo $1 | sed -e 's/^--envfile=//')
      ENVFILE_NAME=$(basename $ENVFILE)
      LOCAL_ENVFILE=$(echo $(cd $(pwd) $ENVFILE && pwd) | sed s@$WORKDIR@$LOCAL_WORKSPACE@)
      ARGS="$ARGS --envfile='$ENVFILE_NAME'"
      ;;
    *)
      ARGS="$ARGS $1"
      ;;
  esac
  shift
done

if [ -z $LOCAL_ENVFILE ]; then
  docker run --rm -it -v ${LOCAL_HOME}/.aws:/root/.aws ecspresso $(echo $ARGS)
else
  docker run --rm -it -v ${LOCAL_HOME}/.aws:/root/.aws -v ${LOCAL_ENVFILE}:${ENVFILE_NAME} ecspresso $(echo $ARGS)
fi
